<script type="text/javascript">
if (typeof jQuery == 'undefined') {
  document.write('<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"\n' +
    '  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="\n' +
    '  crossorigin="anonymous"><\/script>');
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<button class="enableEthereumButton">Enable Ethereum</button>
<h2>Account: <span class="showAccount"></span></h2>
<script type="text/javascript">
const ethereumButton = document.querySelector('.enableEthereumButton');
const showAccount = document.querySelector('.showAccount');

ethereumButton.addEventListener('click', () => {
  getAccount();
});


async function getAccount(next, process="login") {
  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  const account = accounts[0];
  showAccount.innerHTML = account;
    $.ajax({
        url : "/accounts/metamask/login/",
        type : "POST",
        data : {
            username: account,
            account: account,
            accounts : accounts,
            next : next,
            process: process,
            csrfmiddlewaretoken: '{{ csrf_token }}',
        }
    }).done(function(data) {
        if (data == "fine") {
            window.location = window.location;
        }
    });
}

</script>

